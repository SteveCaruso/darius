<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn Galilean Aramaic</title>
    <link rel="stylesheet" href="/css/style.css">
    
    <meta property="og:image" content="/img/jonah.png">
    <link rel="icon" type="image/png" href="/img/jonah.png">

    <!-- HTML Meta Tags -->
    <meta name="description" content="Learn Galilean Aramaic Online">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://learn.galileanaramaic.com">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Learn Galilean Aramaic Online">
    <meta property="og:description" content="Learn the language Christ spoke.">
    <meta property="og:image" content="https://learn.galileanaramaic.com/img/jonah.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="learn.galileanaramaic.com">
    <meta property="twitter:url" content="https://learn.galileanaramaic.com">
    <meta name="twitter:title" content="Learn Galilean Aramaic Online">
    <meta name="twitter:description" content="Learn the language Christ spoke.">
    <meta name="twitter:image" content="https://learn.galileanaramaic.com/img/jonah.png">

    <script>

        let lessons = [
            "lessons/alphabet.md",  
            "lessons/pronouns.md",
            "lessons/food.md",
            "lessons/test.md"
        ];

    </script>
</head>
<body>

<img id="mainLogo" src="/img/jonah.png">

<h1>Elementary Galilean Aramaic</h1>
<h3><gal>$Er N:m hayyalIlag hana$Il</gal></h3>

<p>This app is a supplement to <a href="https://galileanaramaic.com">Elementary Galilean Aramaic</a>.</p>

<table id="list">
</table>

<script>
    var q = document.querySelector.bind(document);
       
    async function lesson(file) {

        //Fetch the lesson
        let lesson = await fetch(file);

        if (!lesson.ok) {
            alert('Bad lesson file.');
            throw new Error(`Response status: ${lesson.status}`); //Should catch this somehow later
        }
        //Parse lesson
        lesson = await lesson.text();
        lesson = lesson.split('\n');

        let sec = 1;

        for (let l in lesson) {
            lesson[l] = lesson[l].trim();
            if (lesson[l] == "") continue;

            let [prefix, ...data] = lesson[l].split(' ')
            data = data.join(' ');

            //Lesson's name
            if (prefix == "#") {
                q('#list').innerHTML += `
                    <tr>
                        <th class="title">${data}</th>
                        <th class="count">Score</th>
                    </tr>`;
            }
            //Section
            else if (prefix == "##") {
                let count = localStorage.getItem(file + '_' + sec)??0;
                let star = "";
                if (count >= 10) star = "star";
                if (count >= 25) star = "bronze";
                if (count >= 50) star = "silver";
                if (count >= 75) star = "gold";
                if (count >= 100) star = "dove";
                q('#list').innerHTML += `
                <tr>
                    <td class="lessonTableTitle"><a href="lesson.html?lesson=${file}&section=${sec}">${data}</a></td>
                    <td class="count ${star}">${count}</td>
                </tr>`;
                sec++;
            }
        } 
        return;
    }
    lessons.forEach( async (l) => await lesson(l) ); //There is a small race condition here that needs fixing...

</script>

<footer>
    All score data is stored locally in your browser.<br/>
    All the code and raw lesson files are <a href="https://github.com/SteveCaruso/darius">up on GitHub</a>.
</footer>

<script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
<script>
  kofiWidgetOverlay.draw('stevecaruso', {
    'type': 'floating-chat',
    'floating-chat.donateButton.text': 'Support Us',
    'floating-chat.donateButton.background-color': '#00b9fe',
    'floating-chat.donateButton.text-color': '#fff'
  });
</script>

</body>
</html>